<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chúc mừng 20/10</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
  <style>
    html,body {height:100%;margin:0;padding:0;}
    body {
      min-height:100vh;
      margin:0;
      overflow-x:hidden;
      font-family:'Quicksand',Arial,sans-serif;
      /* mystical deep background */
      background: radial-gradient(ellipse at top left, #3b0b3b 0%, #160018 35%, #07000a 100%);
      color: #ffdfee;
    }
    @keyframes gradientMove {
      0% {background-position:0% 50%}
      50% {background-position:100% 50%}
      100% {background-position:0% 50%}
    }
    .greeting-container {
      max-width:760px;
      margin:48px auto 0 auto;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border-radius:18px;
      backdrop-filter: blur(6px) saturate(120%);
      padding:34px 20px 30px 20px;
      position:relative;
      overflow:visible;
      z-index:1;
      text-align:center;
    }
    .greeting-title {
      font-family:'Pacifico',cursive;
      font-size:2.2rem;
      color:#ffd1e8;
      margin-bottom:6px;
      letter-spacing:1px;
      opacity:0;
      transform:translateY(-18px);
      animation: fadeInDown 1s 0.1s forwards;
      text-shadow:0 6px 38px rgba(200,80,200,0.12);
    }
    @keyframes fadeInDown {
      to {opacity:1;transform:translateY(0);}
    }
    .greeting-message {
      font-size:1.05rem;
      color:rgba(255,255,255,0.85);
      margin-bottom:18px;
      opacity:0;
      transform:translateY(10px);
      animation: fadeInUp 1.1s 0.6s forwards;
    }
    @keyframes fadeInUp {
      to {opacity:1;transform:translateY(0);}
    }
    .greeting-detail {
      font-size:1.1rem;
      color:#222;
      margin:0 auto 18px auto;
      max-width:420px;
      line-height:1.6;
      opacity:0;
      animation: fadeIn 1.2s 1.2s forwards;
    }
    @keyframes fadeIn {
      to {opacity:1;}
    }
    .share-note {
      color:#666;
      margin-top:18px;
      font-size:0.98rem;
      opacity:0;
      animation: fadeIn 1.2s 1.7s forwards;
    }
    /* Hoa rơi */
    .petal {
      position:fixed;
      top:-60px;
      width:28px;height:28px;
      pointer-events:none;
      z-index:10;
      opacity:0.9;
      will-change:transform;
      filter:drop-shadow(0 6px 18px rgba(0,0,0,0.45));
      animation: petalFall linear forwards;
    }
    @keyframes petalFall {
      to {transform:translateY(110vh) rotate(360deg);opacity:0.7;}
    }
    .greeting-footer {
      margin-top:32px;
      color:#b983ff;
      font-size:1rem;
      opacity:0.7;
    }
    .greeting-btn {
      margin-top:24px;
      padding:12px 32px;
      font-size:1.1rem;
      border-radius:24px;
      border:none;
      background:linear-gradient(90deg,#d72660,#b983ff);
      color:#fff;
      font-family:'Quicksand',sans-serif;
      cursor:pointer;
      box-shadow:0 2px 12px #d7266033;
      transition:background 0.3s,transform 0.2s;
    }
    .greeting-btn:hover {
      background:linear-gradient(90deg,#b983ff,#d72660);
      transform:scale(1.05);
    }
    /* Center pulsing heart */
    .heart-center {
      position:absolute;
      left:50%;
      top:calc(50% + 6px);
      transform:translate(-50%,-50%);
      width:160px;
      height:160px;
      z-index:5;
      pointer-events:auto;
      cursor:pointer;
      filter:drop-shadow(0 12px 40px rgba(220,80,200,0.18));
    }
    .heart-center svg { width:100%; height:100%; display:block; }
    @keyframes beat {
      0% { transform: translate(-50%,-50%) scale(1); }
      30% { transform: translate(-50%,-50%) scale(1.14); }
      45% { transform: translate(-50%,-50%) scale(0.98); }
      100% { transform: translate(-50%,-50%) scale(1); }
    }
    .heart-beating { animation: beat 0.82s ease-out; }
  </style>
</head>
<body>
  <div class="greeting-container">
    <div class="greeting-title">Tặng Mẹ yêu</div>
    <div class="greeting-message">Chạm vào trái tim để mở thiệp nghe mẹ</div>
    <div style="display:flex;justify-content:center;align-items:center;position:relative;margin-top:8px;">
      <canvas id="heartCanvas" width="420" height="420"
        style="width:420px;height:420px;border-radius:20px;overflow:visible;display:block;">
      </canvas>
      <div class="heart-center" id="heartBtn" title="Mở thiệp">
        <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill="none">
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0%" stop-color="#ff9bd6" />
              <stop offset="100%" stop-color="#ff4fa3" />
            </linearGradient>
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="12" result="b" />
              <feMerge>
                <feMergeNode in="b" />
                <feMergeNode in="SourceGraphic" />
              </feMerge>
            </filter>
          </defs>
          <g filter="url(#glow)">
            <path id="heartPath" fill="url(#g1)" d="M256 448s192-112 192-240C448 120 368 48 256 144 144 48 64 120 64 208c0 128 192 240 192 240z"/>
          </g>
        </svg>
      </div>
    </div>
  </div>
  <script>
    // Hoa rơi động
    const petalSVG = `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="16" cy="20" rx="8" ry="12" fill="#ffd1dc"/><ellipse cx="16" cy="12" rx="6" ry="8" fill="#ffb7ef"/><ellipse cx="16" cy="8" rx="3" ry="4" fill="#f9c6e0"/></svg>`;
    function createPetal() {
      const petal = document.createElement('div');
      petal.className = 'petal';
      petal.innerHTML = petalSVG;
      petal.style.left = Math.random()*100 + 'vw';
      petal.style.animationDuration = (6+Math.random()*4)+'s';
      petal.style.transform = `rotate(${Math.random()*360}deg)`;
      document.body.appendChild(petal);
      setTimeout(()=>petal.remove(),10000);
    }
    setInterval(createPetal, 700);
    for(let i=0;i<8;i++) setTimeout(createPetal, i*400);
    // Heart canvas animation and click -> card.html
    (function(){
      const canvas = document.getElementById('heartCanvas');
      if(!canvas) return;
      const ctx = canvas.getContext('2d');
      // size for high-DPI
      function resize() {
        const rect = canvas.getBoundingClientRect();
        const dpr = Math.min(window.devicePixelRatio || 1, 2);
        canvas.width = Math.round(rect.width * dpr);
        canvas.height = Math.round(rect.height * dpr);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      resize();
      window.addEventListener('resize', resize);

      // particle settings (inspired by your code)
      const settings = {
        particles: 300,
        duration: 2.4,
        velocity: 48,
        effect: -0.9,
        size: 10
      };

      class Point { constructor(x=0,y=0){this.x=x;this.y=y;} clone(){return new Point(this.x,this.y);} length(l){ if(typeof l==='undefined') return Math.sqrt(this.x*this.x+this.y*this.y); this.normalize(); this.x*=l; this.y*=l; return this;} normalize(){ const len=this.length(); if(len){this.x/=len;this.y/=len;} return this; }}

      class Particle{ constructor(){ this.pos=new Point(); this.vel=new Point(); this.acc=new Point(); this.age=0; }
        init(x,y,dx,dy){ this.pos.x=x; this.pos.y=y; this.vel.x=dx; this.vel.y=dy; this.acc.x=dx*settings.effect; this.acc.y=dy*settings.effect; this.age=0; }
        update(dt){ this.pos.x += this.vel.x*dt; this.pos.y += this.vel.y*dt; this.vel.x += this.acc.x*dt; this.vel.y += this.acc.y*dt; this.age += dt; }
      }

      const pool = [];
      for(let i=0;i<settings.particles;i++) pool.push(new Particle());
      let firstFree = 0;

      // heart parametric
      function pointOnHeart(t){ return new Point( 0.48 * Math.pow(Math.sin(t),3), 0.48 * (Math.cos(t) - 0.35 * Math.cos(2*t) - 0.14 * Math.cos(3*t) - 0.06 * Math.cos(4*t)) ); }

      // create particle image (small heart) using offscreen canvas
      const heartImg = (function(){
        const c = document.createElement('canvas');
        const s = settings.size*2;
        c.width = s; c.height = s;
        const g = c.getContext('2d');
        g.translate(s/2,s/2);
        g.scale(1,1);
        // path heart
        g.beginPath();
        g.moveTo(0, -s*0.15);
        g.bezierCurveTo(s*0.25, -s*0.6, s*0.9, -s*0.15, 0, s*0.5);
        g.bezierCurveTo(-s*0.9, -s*0.15, -s*0.25, -s*0.6, 0, -s*0.15);
        g.closePath();
        const g1 = g.createLinearGradient(-s/2,-s/2,s/2,s/2);
        g1.addColorStop(0,'#ff9bd6'); g1.addColorStop(1,'#ff4fa3');
        g.fillStyle = g1;
        g.fill();
        const img = new Image(); img.src = c.toDataURL(); return img;
      })();

  let last = performance.now()/1000;
      function spawn() {
        const t = Math.PI - 2*Math.PI*Math.random();
        const p = pointOnHeart(t);
        const rect = canvas.getBoundingClientRect();
        const cx = rect.width/2; const cy = rect.height/2;
        const speed = settings.velocity * (0.7 + Math.random()*0.8);
        const dir = p.clone().length(speed);
        const particle = pool[firstFree];
        particle.init(cx + p.x*rect.width*0.45, cy - p.y*rect.height*0.45, dir.x, -dir.y);
        firstFree = (firstFree + 1) % pool.length;
      }

      // beat controller — triggers a visible beat and momentary particle boost
      let beatInterval = 900; // ms between beats
      let lastBeat = performance.now();
      const heartEl = document.getElementById('heartBtn');

      function doBeat() {
        if(heartEl){
          heartEl.classList.remove('heart-beating');
          // force reflow to restart animation
          void heartEl.offsetWidth;
          heartEl.classList.add('heart-beating');
        }
        // spawn extra particles on beat
        for(let i=0;i<30;i++) spawn();
      }

      setInterval(()=>{
        doBeat();
      }, beatInterval);

      function updateAndDraw() {
        const now = performance.now()/1000; const dt = Math.min(0.05, now - last); last = now;
        // spawn a handful each frame
        for(let i=0;i<4;i++) spawn();
        // clear
        ctx.clearRect(0,0,canvas.width,canvas.height);
        // draw glow background to enhance mystical look
        const r = canvas.width/ (window.devicePixelRatio||1);
        const grd = ctx.createRadialGradient(canvas.width/2, canvas.height/2, r*0.05, canvas.width/2, canvas.height/2, r*0.9);
        grd.addColorStop(0,'rgba(255,140,200,0.06)'); grd.addColorStop(0.4,'rgba(50,0,60,0.2)'); grd.addColorStop(1,'rgba(0,0,0,0)');
        ctx.fillStyle = grd; ctx.fillRect(0,0,canvas.width,canvas.height);

        // update & draw particles
        for(let i=0;i<pool.length;i++){
          const pt = pool[i];
          if(pt.age < settings.duration){
            pt.update(dt);
            const life = 1 - pt.age / settings.duration;
            const size = (settings.size * (0.6 + life*0.8));
            ctx.globalAlpha = 0.9 * life;
            ctx.drawImage(heartImg, pt.pos.x - size/2, pt.pos.y - size/2, size, size);
          }
        }
        ctx.globalAlpha = 1;
        requestAnimationFrame(updateAndDraw);
      }

      // click navigates to card (both canvas and the center heart)
      canvas.addEventListener('click', ()=> window.location.href='card.html');
      const center = document.getElementById('heartBtn');
      if(center){
        center.setAttribute('tabindex','0');
        center.addEventListener('click', ()=> window.location.href='card.html');
        center.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') window.location.href='card.html'; });
      }

      // start loop
      updateAndDraw();
    })();
  </script>
</body>
</html>